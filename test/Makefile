all:
	mkdir -p build
	make -C .. app
	make build_all

clean:
	rm -rf build Autogenerated

TEST_SOURCES = test_main.cpp LineLevelParserTest.cpp ScopeTest.cpp TokenTest.cpp InstructionTest.cpp TokenToVariableTest.cpp \
               ListComparisonTest.cpp StrictEqualityTest.cpp StringFormattingTest.cpp ParserTest.cpp
TEST_OBJECTS = $(TEST_SOURCES:%.cpp=build/%.o)

# ----------------------- Autogenerated files handling ------------------------

TEST_AUTOGEN_SOURCES = test_variable_equal.cpp \
                       test_variable_less.cpp  \
					   test_variable_add.cpp   \
					   test_variable_sub.cpp   \
					   test_variable_mul.cpp   \
					   test_variable_div.cpp   \
					   test_variable_mod.cpp   \
					   test_variable_pow.cpp   \
					   test_variable_int_div.cpp \
					   test_variable_to_bool.cpp \
					   test_variable_to_str.cpp \
					   test_variable.cpp

TEST_AUTOGEN_OBJECTS = $(TEST_AUTOGEN_SOURCES:%.cpp=build/%.o)

Autogenerated/%.cpp: generateVariableTest.py
	mkdir -p Autogenerated
	python3 generateVariableTest.py

$(TEST_AUTOGEN_OBJECTS): build/%.o: Autogenerated/%.cpp
	g++ -c \
	$< \
	-I ../src \
	-I ../variable \
	-I .. \
	-I . \
	-o $@

# ------------------ End of autogenerated files handling ----------------------

build_all: $(TEST_OBJECTS) $(TEST_AUTOGEN_OBJECTS)
	g++ \
	build/*.o \
	../build/common/*.o \
	../build/modules/*.o \
	-I ../src \
	-I . \
	-I .. \
	-l gtest \
	-l gmock \
	-o test

$(TEST_OBJECTS): build/%.o: %.cpp
	g++ -c \
	$< \
	-I ../src \
	-I ../variable \
	-I .. \
	-o $@

